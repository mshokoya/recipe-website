{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nexport function fetchUser() {\n  return _fetchUser.apply(this, arguments);\n}\n\nfunction _fetchUser() {\n  _fetchUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var cookie,\n        res,\n        json,\n        _args = arguments;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            cookie = _args.length > 0 && _args[0] !== undefined ? _args[0] : '';\n\n            if (!(true && window.__user)) {\n              _context.next = 3;\n              break;\n            }\n\n            return _context.abrupt(\"return\", window.__user);\n\n          case 3:\n            _context.next = 5;\n            return fetch('/api/me', cookie ? {\n              headers: {\n                cookie: cookie\n              }\n            } : {});\n\n          case 5:\n            res = _context.sent;\n\n            if (res.ok) {\n              _context.next = 9;\n              break;\n            }\n\n            delete window.__user;\n            return _context.abrupt(\"return\", null);\n\n          case 9:\n            _context.next = 11;\n            return res.json();\n\n          case 11:\n            json = _context.sent;\n\n            if (true) {\n              window.__user = json;\n            }\n\n            return _context.abrupt(\"return\", json);\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _fetchUser.apply(this, arguments);\n}\n\nexport function useFetchUser() {\n  _s();\n\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      required = _ref.required;\n\n  var _useState = useState(function () {\n    return !(true && window.__user);\n  }),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(function () {\n    if (false) {\n      return null;\n    }\n\n    return window.__user || null;\n  }),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  useEffect(function () {\n    if (!loading && user) {\n      return;\n    }\n\n    setLoading(true);\n    var isMounted = true;\n    fetchUser().then(function (user) {\n      // Only set the user if the component is still mounted\n      if (isMounted) {\n        // When the user is not logged in but login is required\n        if (required && !user) {\n          window.location.href = '/api/login';\n          return;\n        }\n\n        setUser(user);\n        setLoading(false);\n      }\n    });\n    return function () {\n      isMounted = false;\n    };\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  return {\n    user: user,\n    loading: loading\n  };\n}\n\n_s(useFetchUser, \"FrGmC3Sfs+IdtiKnUw7ICVE+8o0=\");","map":{"version":3,"sources":["/Users/michaelshokoya/Documents/code/node/recipe-website/src/utils/user.ts"],"names":["useState","useEffect","fetchUser","cookie","window","__user","fetch","headers","res","ok","json","useFetchUser","required","loading","setLoading","user","setUser","isMounted","then","location","href"],"mappings":";;;;;AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AAQA,gBAAsBC,SAAtB;AAAA;AAAA;;;wEAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAyBC,YAAAA,MAAzB,2DAAkC,EAAlC;;AAAA,kBACD,QAAiCC,MAAM,CAACC,MADvC;AAAA;AAAA;AAAA;;AAAA,6CAEID,MAAM,CAACC,MAFX;;AAAA;AAAA;AAAA,mBAKaC,KAAK,CACrB,SADqB,EAErBH,MAAM,GACF;AACEI,cAAAA,OAAO,EAAE;AACPJ,gBAAAA,MAAM,EAANA;AADO;AADX,aADE,GAMF,EARiB,CALlB;;AAAA;AAKCK,YAAAA,GALD;;AAAA,gBAgBAA,GAAG,CAACC,EAhBJ;AAAA;AAAA;AAAA;;AAiBH,mBAAOL,MAAM,CAACC,MAAd;AAjBG,6CAkBI,IAlBJ;;AAAA;AAAA;AAAA,mBAqBcG,GAAG,CAACE,IAAJ,EArBd;;AAAA;AAqBCA,YAAAA,IArBD;;AAsBL,sBAAmC;AACjCN,cAAAA,MAAM,CAACC,MAAP,GAAgBK,IAAhB;AACD;;AAxBI,6CAyBEA,IAzBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AA4BP,OAAO,SAASC,YAAT,GAAsD;AAAA;;AAAA,iFAAJ,EAAI;AAAA,MAA9BC,QAA8B,QAA9BA,QAA8B;;AAAA,kBAC7BZ,QAAQ,CACpC;AAAA,WAAM,EAAE,QAAiCI,MAAM,CAACC,MAA1C,CAAN;AAAA,GADoC,CADqB;AAAA,MACpDQ,OADoD;AAAA,MAC3CC,UAD2C;;AAAA,mBAInCd,QAAQ,CAAC,YAAM;AACrC,eAAmC;AACjC,aAAO,IAAP;AACD;;AAED,WAAOI,MAAM,CAACC,MAAP,IAAiB,IAAxB;AACD,GAN+B,CAJ2B;AAAA,MAIpDU,IAJoD;AAAA,MAI9CC,OAJ8C;;AAY3Df,EAAAA,SAAS,CACP,YAAM;AACJ,QAAI,CAACY,OAAD,IAAYE,IAAhB,EAAsB;AACpB;AACD;;AACDD,IAAAA,UAAU,CAAC,IAAD,CAAV;AACA,QAAIG,SAAS,GAAG,IAAhB;AAEAf,IAAAA,SAAS,GAAGgB,IAAZ,CAAiB,UAACH,IAAD,EAAU;AACzB;AACA,UAAIE,SAAJ,EAAe;AACb;AACA,YAAIL,QAAQ,IAAI,CAACG,IAAjB,EAAuB;AACrBX,UAAAA,MAAM,CAACe,QAAP,CAAgBC,IAAhB,GAAuB,YAAvB;AACA;AACD;;AACDJ,QAAAA,OAAO,CAACD,IAAD,CAAP;AACAD,QAAAA,UAAU,CAAC,KAAD,CAAV;AACD;AACF,KAXD;AAaA,WAAO,YAAM;AACXG,MAAAA,SAAS,GAAG,KAAZ;AACD,KAFD;AAGD,GAxBM,EAyBP;AACA,IA1BO,CAAT;AA6BA,SAAO;AAAEF,IAAAA,IAAI,EAAJA,IAAF;AAAQF,IAAAA,OAAO,EAAPA;AAAR,GAAP;AACD;;GA1CeF,Y","sourcesContent":["import { useState, useEffect } from 'react';\n\ninterface MyWindow extends Window {\n  __user: any;\n}\n\ndeclare var window: MyWindow;\n\nexport async function fetchUser(cookie = '') {\n  if (typeof window !== 'undefined' && window.__user) {\n    return window.__user\n  }\n\n  const res = await fetch(\n    '/api/me',\n    cookie\n      ? {\n          headers: {\n            cookie,\n          },\n        }\n      : {}\n  )\n\n  if (!res.ok) {\n    delete window.__user\n    return null\n  }\n\n  const json = await res.json()\n  if (typeof window !== 'undefined') {\n    window.__user = json\n  }\n  return json\n}\n\nexport function useFetchUser({ required }: {required?} = {}) {\n  const [loading, setLoading] = useState(\n    () => !(typeof window !== 'undefined' && window.__user)\n  )\n  const [user, setUser] = useState(() => {\n    if (typeof window === 'undefined') {\n      return null\n    }\n\n    return window.__user || null\n  })\n\n  useEffect(\n    () => {\n      if (!loading && user) {\n        return\n      }\n      setLoading(true)\n      let isMounted = true\n\n      fetchUser().then((user) => {\n        // Only set the user if the component is still mounted\n        if (isMounted) {\n          // When the user is not logged in but login is required\n          if (required && !user) {\n            window.location.href = '/api/login'\n            return\n          }\n          setUser(user)\n          setLoading(false)\n        }\n      })\n\n      return () => {\n        isMounted = false\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  )\n\n  return { user, loading }\n}"]},"metadata":{},"sourceType":"module"}